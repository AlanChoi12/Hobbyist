# Piano #

## 项目目的 ##
钢琴有“乐器之王”的美称，钢琴在新的乐器分类中属于击奏鸣弦乐器。这种广泛用于世界各国的键盘乐器，既能演奏和声与复调音乐，又能担任独奏、重奏和伴奏。它音域特别宽广，表现力极强。然而钢琴具有高难度的弹奏技巧，没有学过钢琴看不懂五线谱，不熟悉键盘的朋友就只能呵呵了。于是，小组决定运用所学知识做一个钢琴学习机，让没有学过乐理知识的朋友们也能体会到音符在自己指尖上游走的喜悦。

## 项目要求 ##
>1. 上位机基于windows系统平台上的软件开发，目的将网络上以图片格式互传的五线谱翻译成下位机能够识别的音符信号，这些信号以文本的形式保存于内存卡内。
>1. 下位机使用Cortex-M3内核的ARM芯片STM32F103C8T6单片机作为主控芯片，STM32F103C8T6内部资源配备64K的flash以及20K的RAM，搭载uC/OS实时性操作系统。
>1. MCU进行读TF卡，将文档内的音符信号读取、识别后驱动LED进行指示。
>1. 学习机具有4个实体按键，一个OLED屏幕进行可视化操作。

## 开发步骤 ##
### 乐理引入 ###
> 1. 五线谱，由5根等距离的平行横线、标以不同时值的音符及其他记号来记载音乐。有高音谱及低音谱两部分，分别对应右手及左手的弹奏。
> 2. 音符时值，也称为音符值或音值，在乐谱中用来表达各音符之间的相对持续时间。一个完全音符(全音符)等于两个二分音符；等于四个四分音符，八个八分音符；十六个十六分音符，三十二个三十二分音符。这只是音符时值的比例。下图中的音符在五线谱中的变现方法。
	http://c.hiphotos.baidu.com/baike/pic/item/eaf81a4c510fd9f96decf4ce252dd42a2934a49a.jpg
> 3. 拍号，或拍子记号。是用分数的形式来标画的，其意义是分母表示拍子的时值也就是说用几分音符来当一拍，分子表示每一小节里有几拍，比如2/4拍就是以四分音符为一拍，一小节有2拍，3/4以四分音符为一拍，每小节有三拍。读法是先读分母，再读分子，比如2/4叫四二拍，3/4叫四三拍，6/8叫八六拍。
> 4. BPM值，中文名为拍子数，释义为每分钟节拍数的单位。就是在一分钟的时间段落之间，所发出的声音节拍的数量，如图左上角所示，一个四分音符等于96。
	http://baike.baidu.com/picture/19812/19812/1125220/5f9e93b1a927611a092302a7#aid=1125220&pic=5f9e93b1a927611a092302a7
> 5. 附点音符，音符后加一个黑点的音符就叫附点音符，该音符的时值等于所附的音符加上自身的一半，比如3·(附点四分音符)，它的时值为一个四分音符加一个二分音符，并且都发一个音mi。
### 功能实现 ###
> 1. 上位机将乐谱按照音符时值、拍号、BPM值、附点音符等符号的规则进行转换。
> 2. 下位机搭载uC/OS实时操作系统。使用I2C接口驱动OLED屏，显示操作内容。使用SPI通讯方式进行读tf卡，读取出对应音符及时值，根据这些参数驱动88个LED进行指示。

#### Example ####
>《千与千寻之神隐少女》简谱中，拍号为3/4；BPM值为120；音符时值包含有：

> | 0(休止符)  -  do(二分音符) re(二分音符) |

> | mi(二分音符) do(二分音符) so（附点四分音符)  mi(二分音符)|

> 两竖线间代表一个小节，四分音符为一拍，一拍的时间为60/120=0.5s,于是得知一个小节的时间为0.5x3=1.5s,一个二分音符的时间值为0.25s，一个附点四分音符的时间值为0.5+0.25=0.75s。

> 第一小节中只有do跟re两个二分音符，必须组合在一起，时间值为一拍，所以0(休止符)与“ - ”各占一拍，无发音，共3拍。第二小节中，mi跟do合成一拍，so占一拍半，最后的mi占半拍，共3拍。

> 时间轴演示如下：

> 0......................................do......re.......mi.....do.......so..........................mi........|

> 0s...0.25s...0.5s...0.75s...1s...1.25s...1.5s...1.75s...2s...2.25s...2.5s...2.75s...3s

> 那么上位机输出的txt文档内应当包含乐谱中每小节内有哪些音符(88键中高低音组的do到si的哪一个)以及其时间值（延时多少秒）。
